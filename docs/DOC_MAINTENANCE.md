# ドキュメントメンテナンスガイド

CLAUDE_*.mdファイルの肥大化を防ぎ、開発速度を維持するためのガイドライン。

---

## 🎯 基本方針

### ファイルサイズの上限
| ファイル | 上限行数 | 現在 | 目的 |
|---------|---------|------|------|
| CLAUDE.md | 80行 | 59行 | プロジェクト概要、最頻出コマンド |
| CLAUDE_COMMANDS.md | 160行 | 153行 | コマンド・GAS関数リファレンス |
| CLAUDE_TASKS.md | 120行 | 110行 | タスク別フロー |
| CLAUDE_NAV.md | 110行 | 99行 | ナビゲーション、索引 |
| CLAUDE_ARCH.md | 200行 | 185行 | アーキテクチャ概要 |
| **合計** | **670行** | **606行** | - |

**警告**: 合計が700行を超えたら即座に見直しが必要

---

## 📝 追加・更新時のルール

### 1. 情報の階層化
```
CLAUDE_*.md（概要・頻出情報のみ）
    ↓ 詳細は委譲
docs/*.md（詳細情報・仕様）
```

### 2. 追加前のチェックリスト
新しい情報を追加する前に自問:
- [ ] この情報は週に1回以上参照されるか？
  - YES → CLAUDE_*.mdに追加可能
  - NO → docs/に追加
- [ ] この情報は既存の説明で十分か？
  - YES → 追加不要
  - NO → 最小限の文言で追加
- [ ] この情報は既に別の場所にあるか？
  - YES → リンクで参照
  - NO → 追加可能

### 3. 具体例

#### ❌ 悪い例（冗長）
```markdown
## データフロー

データの流れは以下のようになっています。まずGitHub APIからデータを取得します。
次にそのデータをメトリクス計算サービスで処理します。計算が完了したら、
スプレッドシートサービスに渡してシートに書き込みます...（200行）
```

#### ✅ 良い例（簡潔）
```markdown
## データフロー
GitHub API → データ取得 → メトリクス計算 → スプレッドシート出力

**詳細**: [ARCHITECTURE.md](docs/ARCHITECTURE.md)
```

---

## 🔄 定期見直しプロセス

### 四半期ごとのレビュー
1. **使用頻度の確認**
   - 過去3ヶ月でほとんど参照されていないセクションを特定
   - 参照頻度の低い情報はdocs/へ移動

2. **重複チェック**
   ```bash
   # 類似テキストを検索
   grep -r "特定のキーワード" CLAUDE*.md
   ```

3. **行数チェック**
   ```bash
   wc -l CLAUDE*.md
   # 合計が700行超えたら要見直し
   ```

### 見直しトリガー
以下の場合は即座に見直し:
- CLAUDE_*.md合計が700行を超えた時
- 単一ファイルが上限行数を超えた時
- 新機能追加で大量のドキュメントが必要になった時

---

## 🛠 実践的なテクニック

### 1. 箇条書きを活用
❌ 冗長:
```markdown
まず要件を確認します。次に既存のパターンを確認します。
その後実装を行い、テストを追加し、品質チェックを実施します。
```

✅ 簡潔:
```markdown
1. 要件確認
2. 既存パターン確認
3. 実装
4. テスト追加
5. 品質チェック
```

### 2. 表形式でまとめる
❌ 冗長:
```markdown
Deployment Frequencyはデプロイ回数を期間で割って計算します。
Lead TimeはIssue作成から本番マージまでの中央値です。
Change Failure Rateは...
```

✅ 簡潔:
```markdown
| 指標 | 計算方法 |
|------|---------|
| Deployment Frequency | デプロイ回数/期間 |
| Lead Time | Issue作成→本番マージの中央値 |
| Change Failure Rate | インシデント関連PR / 全PR |
```

### 3. 詳細へのリンク
必ず以下のパターンを使用:
```markdown
**詳細**: [ドキュメント名](パス)
**参考**: [ドキュメント名](パス)
**関連**: [ドキュメント名](パス)
```

---

## 📊 メトリクス

### 追跡すべき指標
- **総行数**: 606行（目標: 670行以下）
- **平均ファイルサイズ**: 121行（目標: 134行以下）
- **最大ファイルサイズ**: 185行（目標: 200行以下）

### 測定コマンド
```bash
# 現在の状態を確認
wc -l CLAUDE*.md

# 変更差分を確認
git diff HEAD~1 CLAUDE*.md --stat
```

---

## 🚨 警告サイン

以下の兆候が見られたら、即座に見直しが必要:

1. **行数の急増**
   - 1つのPRで50行以上追加
   - 合計が650行を超えた

2. **重複の増加**
   - 同じ情報が複数ファイルに記載
   - コピペされたセクションが存在

3. **詳細説明の増加**
   - 「詳細は...」リンクが減少
   - インラインで長文説明が増加

4. **構造の複雑化**
   - ネストが3階層以上
   - セクションが10個以上

---

## 💡 最適化の例

### 実際の改善例（2026年2月）
```
Before: 900行（ARCH:299, TASKS:215, NAV:153, COMMANDS:174）
After:  606行（ARCH:185, TASKS:110, NAV:99, COMMANDS:153）
削減:   294行（33%削減）

施策:
- 詳細フローを箇条書きに簡潔化
- 重複していたドキュメントマトリックスを統合
- 説明文を削除し、docs/への委譲を徹底
```

---

## 🔗 関連ドキュメント

- [CLAUDE.md](../CLAUDE.md) - プロジェクト概要
- [CODE_QUALITY.md](CODE_QUALITY.md) - コード品質基準
- [REFACTORING_GUIDE.md](REFACTORING_GUIDE.md) - リファクタリングガイド
